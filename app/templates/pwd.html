{% extends "base.html" %}

{% block title %}登录 - tgState{% endblock %}

{% block content %}
<div style="display: flex; align-items: center; justify-content: center; min-height: 60vh;">
    <div class="card" style="width: 100%; max-width: 400px; padding: 32px;">
        <div style="text-align: center; margin-bottom: 24px;">
            <div style="width: 48px; height: 48px; background: var(--bg-surface-hover); border-radius: 12px; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 16px; color: var(--primary-color);">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
            </div>
            <h1 style="font-size: 20px; font-weight: 700; margin-bottom: 8px;">需要验证</h1>
            <p style="color: var(--text-secondary); font-size: 14px;">请输入管理员密码以继续。</p>
        </div>

        <form id="login-form" onsubmit="return false;">
            <div class="input-group">
                <label class="input-label">密码</label>
                <input type="password" class="input-field" id="password" name="password" placeholder="请输入密码" required autofocus>
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;" onclick="submitLogin()">登录</button>
        </form>
    </div>
</div>

<script>
async function submitLogin() {
    const pwd = document.getElementById('password').value;
    if (!pwd) return;
    
    const btn = document.querySelector('button[type="submit"]');
    Utils.setLoading(btn, true);
    
    try {
        const res = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ password: pwd })
        });
        
        if (res.ok) {
            window.location.replace('/');
        } else {
            Toast.show('密码错误', 'error');
            document.getElementById('password').value = '';
            document.getElementById('password').focus();
        }
    } catch (e) {
        Toast.show('网络错误', 'error');
    } finally {
        Utils.setLoading(btn, false);
    }
}
</script>
{% endblock %}
